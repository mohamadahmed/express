"use strict";var express=require("express"),request=require("request"),cheerio=require("cheerio"),bodyParser=require("body-parser"),app=express();app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!0})),app.use(express.static("public")),app.set("views","./view"),app.set("view engine","ejs"),app.get("/",function(e,r){r.render("urlForm.ejs",{error:"no error"})}),app.post("/pageContent",function(e,r){function t(e){var r=e.match('<!DOCTYPE((.|\n|\r)*?)">');r&&"undefined"!==r&&(a=-1!==r[1].indexOf("PUBLIC")?"HTML version 4.01 or older":"HTML version 5")}function s(e){var r=e(":header");o=r&&"undefined"!==r.length?r.length:"null",e(r).each(function(e,r){r.name&&d.push(r.name)})}function n(e){var r=e("form").html();u=r?"Form Exist!!!":"Form Not Exist!!!"}function i(e){var r,t=/^(?:\w+\:\/\/)?([^\/]+)(.*)$/.exec(p)[1],s=e("a");e(s).each(function(s,n){(r=e(n).attr("href"))&&"undefined"!==r&&(-1!==r.indexOf(t)?c.push({href:r,text:e(n).text()}):"/"==r.slice(0,1)?c.push({href:r,text:e(n).text()}):"#"==r.slice(0,1)?f.push({href:r,text:e(n).text()}):h.push({href:r,text:e(n).text()}))})}var a,o,u,p=e.body.website,d=[],c=[],h=[],f=[];request(p,function(e,p,l){if(e||200!=p.statusCode)"ENOTFOUND"===e.code?r.status(404):"ECONNREFUSED"===e.code?r.status(408):r.status(400),r.render("urlForm.ejs",{error:e.code,errorStatus:r.statusCode});else{var x=cheerio.load(l),v=x("head > title").text();t(l),s(x),i(x),n(x);var m={htmlVersion:a,title:v,headersLength:o,header:d,externalLinksArr:h,internalLinksArr:c,inaccessibleLinksArr:f,form:u};r.render("pageContent.ejs",m)}})}),app.listen(3e3);